<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>2024羊城杯chal | The Blog of WoaW04</title><meta name="author" content="WoaW04"><meta name="copyright" content="WoaW04"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="0x00 前言Cython逆向，借机学一下：Cython 二进制库逆向分析全面指南 WP来自2024年羊城杯粤港澳大湾区网络安全大赛WP-Reverse篇（全网唯一chal题解的含金量） 本体对环境有要求，一定要是linux+python3.12的环境 0x01 解根据给出的main.py，可以知道chal里面有个chal 1234import chalflag &#x3D; input(&quot;fla">
<meta property="og:type" content="article">
<meta property="og:title" content="2024羊城杯chal">
<meta property="og:url" content="http://example.com/2024/09/18/2024%E7%BE%8A%E5%9F%8E%E6%9D%AFchal/index.html">
<meta property="og:site_name" content="The Blog of WoaW04">
<meta property="og:description" content="0x00 前言Cython逆向，借机学一下：Cython 二进制库逆向分析全面指南 WP来自2024年羊城杯粤港澳大湾区网络安全大赛WP-Reverse篇（全网唯一chal题解的含金量） 本体对环境有要求，一定要是linux+python3.12的环境 0x01 解根据给出的main.py，可以知道chal里面有个chal 1234import chalflag &#x3D; input(&quot;fla">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/WoaW04/Picture/main/202409182255885.png">
<meta property="article:published_time" content="2024-09-18T13:31:45.000Z">
<meta property="article:modified_time" content="2024-09-21T08:47:07.474Z">
<meta property="article:author" content="WoaW04">
<meta property="article:tag" content="RE">
<meta property="article:tag" content="2024羊城杯">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/WoaW04/Picture/main/202409182255885.png"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/WoaW04/Picture/image04CTF.png"><link rel="canonical" href="http://example.com/2024/09/18/2024%E7%BE%8A%E5%9F%8E%E6%9D%AFchal/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: false,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '2024羊城杯chal',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-21 16:47:07'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/WoaW04/Picture/image04CTF.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">53</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://raw.githubusercontent.com/WoaW04/Picture/main/202409182255885.png')"><nav id="nav"><span id="blog-info"><a href="/" title="The Blog of WoaW04"><img class="site-icon" src="https://cdn.jsdelivr.net/gh/WoaW04/Picture/image04CTF.png"/><span class="site-name">The Blog of WoaW04</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">2024羊城杯chal</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-09-18T13:31:45.000Z" title="发表于 2024-09-18 21:31:45">2024-09-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-09-21T08:47:07.474Z" title="更新于 2024-09-21 16:47:07">2024-09-21</time></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>Cython逆向，借机学一下：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzUzMDUxNTE1Mw==&mid=2247507102&idx=1&sn=5b38235bb8f8bb1dd5b4e2e0325f3f48&scene=21&ref=www.ctfiot.com#wechat_redirect">Cython 二进制库逆向分析全面指南</a></p>
<p>WP来自<a target="_blank" rel="noopener" href="https://www.ctfiot.com/203459.html">2024年羊城杯粤港澳大湾区网络安全大赛WP-Reverse篇</a>（全网唯一chal题解的含金量）</p>
<p>本体对环境有要求，一定要是linux+python3.12的环境</p>
<h2 id="0x01-解"><a href="#0x01-解" class="headerlink" title="0x01 解"></a>0x01 解</h2><p>根据给出的main.py，可以知道chal里面有个chal</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import chal</span><br><span class="line"></span><br><span class="line">flag = input(&quot;flag: &quot;)</span><br><span class="line">chal.chal(flag)</span><br></pre></td></tr></table></figure>

<p>开启python，导入一下chal库然后打印一下属性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Python <span class="number">3.12</span><span class="number">.5</span> | packaged by Anaconda, Inc. | (main, Sep <span class="number">12</span> <span class="number">2024</span>, <span class="number">18</span>:<span class="number">27</span>:<span class="number">27</span>) [GCC <span class="number">11.2</span><span class="number">.0</span>] on linux</span><br><span class="line"><span class="type">Type</span> <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> <span class="keyword">or</span> <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> chal</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dir</span>(chal)</span><br><span class="line">[<span class="string">&#x27;__builtins__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>, <span class="string">&#x27;__file__&#x27;</span>, <span class="string">&#x27;__loader__&#x27;</span>, <span class="string">&#x27;__name__&#x27;</span>, <span class="string">&#x27;__package__&#x27;</span>, <span class="string">&#x27;__spec__&#x27;</span>, <span class="string">&#x27;__test__&#x27;</span>, <span class="string">&#x27;chal&#x27;</span>, <span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;random&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dir</span>(chal.chal)</span><br><span class="line">[<span class="string">&#x27;__class__&#x27;</span>, <span class="string">&#x27;__delattr__&#x27;</span>, <span class="string">&#x27;__dict__&#x27;</span>, <span class="string">&#x27;__dir__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>, <span class="string">&#x27;__eq__&#x27;</span>, <span class="string">&#x27;__format__&#x27;</span>, <span class="string">&#x27;__ge__&#x27;</span>, <span class="string">&#x27;__getattribute__&#x27;</span>, <span class="string">&#x27;__getstate__&#x27;</span>, <span class="string">&#x27;__gt__&#x27;</span>, <span class="string">&#x27;__hash__&#x27;</span>, <span class="string">&#x27;__init__&#x27;</span>, <span class="string">&#x27;__init_subclass__&#x27;</span>, <span class="string">&#x27;__le__&#x27;</span>, <span class="string">&#x27;__lt__&#x27;</span>, <span class="string">&#x27;__module__&#x27;</span>, <span class="string">&#x27;__ne__&#x27;</span>, <span class="string">&#x27;__new__&#x27;</span>, <span class="string">&#x27;__reduce__&#x27;</span>, <span class="string">&#x27;__reduce_ex__&#x27;</span>, <span class="string">&#x27;__repr__&#x27;</span>, <span class="string">&#x27;__setattr__&#x27;</span>, <span class="string">&#x27;__sizeof__&#x27;</span>, <span class="string">&#x27;__str__&#x27;</span>, <span class="string">&#x27;__subclasshook__&#x27;</span>, <span class="string">&#x27;__weakref__&#x27;</span>, <span class="string">&#x27;_p1&#x27;</span>, <span class="string">&#x27;_p2&#x27;</span>, <span class="string">&#x27;_p3&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>chal.chal._p1</span><br><span class="line">&lt;cyfunction chal._p1 at <span class="number">0x7f40fe598860</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>chal.chal._p2</span><br><span class="line">&lt;cyfunction chal._p2 at <span class="number">0x7f40fe598930</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>chal.chal._p3</span><br><span class="line">&lt;cyfunction chal._p3 at <span class="number">0x7f40fe598a00</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dir</span>(chal.chal(<span class="string">&#x27;a&#x27;</span>))</span><br><span class="line">[<span class="string">&#x27;__class__&#x27;</span>, <span class="string">&#x27;__delattr__&#x27;</span>, <span class="string">&#x27;__dict__&#x27;</span>, <span class="string">&#x27;__dir__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>, <span class="string">&#x27;__eq__&#x27;</span>, <span class="string">&#x27;__format__&#x27;</span>, <span class="string">&#x27;__ge__&#x27;</span>, <span class="string">&#x27;__getattribute__&#x27;</span>, <span class="string">&#x27;__getstate__&#x27;</span>, <span class="string">&#x27;__gt__&#x27;</span>, <span class="string">&#x27;__hash__&#x27;</span>, <span class="string">&#x27;__init__&#x27;</span>, <span class="string">&#x27;__init_subclass__&#x27;</span>, <span class="string">&#x27;__le__&#x27;</span>, <span class="string">&#x27;__lt__&#x27;</span>, <span class="string">&#x27;__module__&#x27;</span>, <span class="string">&#x27;__ne__&#x27;</span>, <span class="string">&#x27;__new__&#x27;</span>, <span class="string">&#x27;__reduce__&#x27;</span>, <span class="string">&#x27;__reduce_ex__&#x27;</span>, <span class="string">&#x27;__repr__&#x27;</span>, <span class="string">&#x27;__setattr__&#x27;</span>, <span class="string">&#x27;__sizeof__&#x27;</span>, <span class="string">&#x27;__str__&#x27;</span>, <span class="string">&#x27;__subclasshook__&#x27;</span>, <span class="string">&#x27;__weakref__&#x27;</span>, <span class="string">&#x27;_p1&#x27;</span>, <span class="string">&#x27;_p2&#x27;</span>, <span class="string">&#x27;_p3&#x27;</span>, <span class="string">&#x27;_tips&#x27;</span>, <span class="string">&#x27;_var1&#x27;</span>, <span class="string">&#x27;_var2&#x27;</span>, <span class="string">&#x27;_var3&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>chal.chal(<span class="string">&#x27;a&#x27;</span>)._tips</span><br><span class="line"><span class="string">&quot;Don&#x27;t peek!!!&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>chal.chal(<span class="string">&#x27;a&#x27;</span>)._var1</span><br><span class="line"><span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>chal.chal(<span class="string">&#x27;a&#x27;</span>)._var2</span><br><span class="line">[<span class="number">121</span>, <span class="number">73</span>, <span class="number">141</span>, <span class="number">146</span>, <span class="number">115</span>, <span class="number">230</span>, <span class="number">181</span>, <span class="number">65</span>, <span class="number">238</span>, <span class="number">17</span>, <span class="number">146</span>, <span class="number">73</span>, <span class="number">228</span>, <span class="number">82</span>, <span class="number">188</span>, <span class="number">66</span>, <span class="number">12</span>, <span class="number">148</span>, <span class="number">225</span>, <span class="number">66</span>, <span class="number">255</span>, <span class="number">254</span>, <span class="number">47</span>, <span class="number">22</span>, <span class="number">163</span>, <span class="number">250</span>, <span class="number">222</span>, <span class="number">133</span>, <span class="number">35</span>, <span class="number">232</span>, <span class="number">106</span>, <span class="number">176</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>chal.chal(<span class="string">&#x27;a&#x27;</span>)._var3</span><br><span class="line">[<span class="number">12</span>, <span class="number">243</span>, <span class="number">133</span>, <span class="number">147</span>, <span class="number">7</span>, <span class="number">36</span>, <span class="number">29</span>, <span class="number">49</span>, <span class="number">226</span>, <span class="number">211</span>, <span class="number">156</span>, <span class="number">56</span>, <span class="number">142</span>, <span class="number">78</span>, <span class="number">254</span>, <span class="number">12</span>]</span><br></pre></td></tr></table></figure>

<p>第一步可以发现chal实际上是chal模块里的一个类</p>
<p>第二步可以发现类里面有<code>_p1</code>、<code>_p2</code>、<code>_p3</code>三个函数</p>
<p>第三步初始化以后多了<code>_tips</code>、<code>_var1</code>、<code>_var2</code>、<code>_var3</code>四个变量，其中<code>_var1</code>存储的就是输入，<code>_var2</code>和<code>_var3</code>是固定数组</p>
<p>main.py里面实际上是用输入的flag初始化了一个chal.chal类，对flag的校验在类的<code>__init__</code>函数中。而<code>__init__</code>函数透露信息不多，因此归根到底得看伪代码（）</p>
<h3 id="C级别的全局变量赋值"><a href="#C级别的全局变量赋值" class="headerlink" title="C级别的全局变量赋值"></a>C级别的全局变量赋值</h3><h4 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h4><p>在Cython中，使用函数<code>_Pyx_CreateStringTabAndInitStrings</code>进行全局字符串赋值，在函数中，可以看到如下这个样子的函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v8 = _mm_unpacklo_epi64((__m128i)(<span class="type">unsigned</span> __int64)&amp;qword_28A98, (__m128i)(<span class="type">unsigned</span> __int64)<span class="string">&quot;AttributeError&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>这个意思就是将<code>&quot;AttributeError&quot;</code>这个字符串放入<code>&amp;qword_28A98</code>这个地址进行存储，后面需要用到这个字符串的时候将直接调这个地址</p>
<blockquote>
<p>实际上，该函数中使用的字符串定义结构体是这样的（可以参考这个<a target="_blank" rel="noopener" href="https://taardisaa.github.io/2022/01/25/Cython%20Reverse/">Cython程序分析_1</a>）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    PyObject **p;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *s;</span><br><span class="line">    <span class="type">const</span> Py_ssize_t n;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* encoding;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> is_unicode;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> is_str;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> intern;</span><br><span class="line">&#125; __Pyx_StringTabEntry;</span><br></pre></td></tr></table></figure>

<p>而字符串是通过<code>__Pyx_StringTabEntry</code>的数组进行初始化的，也就是说当我们在该函数中看到以下伪代码时：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__m128i v8;</span><br><span class="line">__int64 v9;</span><br><span class="line">__int64 v10;</span><br><span class="line">__int16 v11;</span><br><span class="line"><span class="type">char</span> v12;</span><br><span class="line"></span><br><span class="line">v8 = _mm_unpacklo_epi64(&amp;qword_28A98, <span class="string">&quot;AttributeError&quot;</span>);</span><br><span class="line">v9 = <span class="number">15LL</span>;   <span class="comment">// len</span></span><br><span class="line">v10 = <span class="number">0LL</span>;</span><br><span class="line">v11 = <span class="number">0x100</span>; <span class="comment">// 1 and 0 (binary = 0000 0001 0000 0000)</span></span><br><span class="line">v12 = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>就代表这是一个<code>&#123;&amp;qword_28A98, &quot;AttributeError&quot;, 15, 0, 1, 0, 1&#125;</code>的<code>__Pyx_StringTabEntry</code>，也就是说<code>qword_28A98</code>中将要初始化一个内容是<code>&quot;AttributeError&quot;</code>的字符串对象的地址，在后续调用中，调用到AttributeError字符串的地方都会用<code>&amp;qword_28A98</code>指代。</p>
</blockquote>
<h4 id="整数类型"><a href="#整数类型" class="headerlink" title="整数类型"></a>整数类型</h4><p>在函数<code>_pyx_pymod_exec_chal</code>中（最后是库名字，只要找<code>__pyx_pymod_exec_</code>即可），第205行左右，可以找到形如这样的内容：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qword_28DE8 = PyLong_FromLong(<span class="number">0LL</span>);</span><br><span class="line"><span class="keyword">if</span> ( qword_28DE8 )</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在<code>__pyx_pymod_exec_test2()</code>函数的前半段都是检查和初始化。这里可以搜索到初始化的<code>Python int</code>型变量（<code>PyLong_FromLong</code>）。</p>
<p><a target="_blank" rel="noopener" href="https://taardisaa.github.io/2022/01/27/Cython%20Reverse%202/">Cython程序分析_2</a></p>
</blockquote>
<p>这个地方就是赋值了一个整数类型，<code>qword_28DE8</code>中将存储一个值为<code>0</code>的整数类型的Python对象。</p>
<p>而在983行左右的位置可以看到这样的内容</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qword_29600 = PyLong_FromString(<span class="string">&quot;2654435769&quot;</span>, <span class="number">0LL</span>, <span class="number">0LL</span>);</span><br><span class="line"><span class="keyword">if</span> ( qword_29600 )</span><br></pre></td></tr></table></figure>

<p>这是大数的存储方式，大数会用<code>PyLong_FromString</code>函数来初始化，这里<code>qword_29600</code>中将存储一个值为<code>2654435769</code>的整数类型的Python对象，后续用到<code>2654435769</code>的地方将使用<code>qword_29600</code>。</p>
<h4 id="内建函数-变量"><a href="#内建函数-变量" class="headerlink" title="内建函数&#x2F;变量"></a>内建函数&#x2F;变量</h4><p>在函数<code>_pyx_pymod_exec_chal</code>中，第1042行左右，可以找到如下内容（在某些优化下也会直接嵌入 <code>_pyx_pymod_exec_chal</code>）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( (<span class="type">int</span>)_Pyx_InitCachedBuiltins() &lt; <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">  v32 = <span class="number">0LL</span>;</span><br><span class="line">  v7 = <span class="number">0LL</span>;</span><br><span class="line">  v33 = <span class="number">10294</span>;</span><br><span class="line">  v35 = <span class="number">1</span>;</span><br><span class="line">  v34 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">goto</span> LABEL_349;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此处是初始化<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Ladylittleleaf/p/10240096.html">内建函数</a></p>
<blockquote>
<p>事实上，在函数<code>_Pyx_InitCachedBuiltins()</code>中可以看到形如以下的内容：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_pyx_builtin_AttributeError = _Pyx_GetBuiltinName(qword_28A98);</span><br><span class="line"><span class="keyword">if</span> ( !_pyx_builtin_AttributeError )</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br></pre></td></tr></table></figure>

<p><code>qword_28A98</code>就是前面的<code>&quot;AttributeError&quot;</code>字符串，这里是通过名字找到<code>AttributeError</code>对象，并赋值给<code>_pyx_builtin_AttributeError</code>，后续用到<code>AttributeError</code>对象的地方将使用<code>_pyx_builtin_AttributeError</code>。</p>
</blockquote>
<h4 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h4><p>在函数<code>_pyx_pymod_exec_chal</code>中，第1051行左右，可以找到如下内容（在某些优化下也会直接嵌入 <code>_pyx_pymod_exec_chal</code>）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">inited = _Pyx_InitCachedConstants();</span><br><span class="line"><span class="keyword">if</span> ( inited &lt; <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">  v32 = <span class="number">0LL</span>;</span><br><span class="line">  v7 = <span class="number">0LL</span>;</span><br><span class="line">  v33 = <span class="number">10296</span>;</span><br><span class="line">  v35 = <span class="number">1</span>;</span><br><span class="line">  v34 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">goto</span> LABEL_349;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此处是初始化常量</p>
<blockquote>
<p>在函数<code>_Pyx_InitCachedConstants()</code>中可以找到形如以下的内容：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;qword_29630 = PyTuple_Pack(<span class="number">2LL</span>, qword_29600, qword_29618); </span><br><span class="line">&gt;<span class="comment">// 我这个地方是只有qword_29600，但是汇编是能看到qword_29618的，怀疑是IDA反编译的锅</span></span><br><span class="line">&gt;<span class="keyword">if</span> ( !qword_29630 )</span><br><span class="line"> <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br></pre></td></tr></table></figure>

<p><code>qword_29600</code>就是前面的值为<code>2654435769</code>的整数类型的Python对象，同理<code>qword_29618</code>就是值为<code>3337565984</code>的整数类型的Python对象。这里将这两个对象打包成了一个长度为<code>2</code>的元组<code>(2654435769, 3337565984)</code>，并赋值给<code>qword_29630</code>变量，后续用到这个元组的地方将使用<code>qword_29630</code>。</p>
</blockquote>
<h4 id="函数声明及定义"><a href="#函数声明及定义" class="headerlink" title="函数声明及定义"></a>函数声明及定义</h4><blockquote>
<p>声明在<code>_Pyx_InitCachedConstants</code>, called by <code>_pyx_pymod_exec_chal</code></p>
<p>（在某些优化下也会直接嵌入 <code>_pyx_pymod_exec_chal</code>）</p>
<p>定义在<code>_pyx_pymod_exec_chal</code></p>
</blockquote>
<p>即函数的声明和常量在同一个函数中进行初始化，常量上文给出了例子，函数的声明则如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">qword_29660 = PyTuple_Pack(<span class="number">7LL</span>, qword_28C98);</span><br><span class="line"><span class="keyword">if</span> ( !qword_29660 )</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">qword_29688 = _Pyx_PyCode_New_constprop_0(</span><br><span class="line">                <span class="number">3</span>,</span><br><span class="line">                <span class="number">7</span>,</span><br><span class="line">                qword_28A80,</span><br><span class="line">                qword_28A78,</span><br><span class="line">                qword_28A78,</span><br><span class="line">                qword_29660,</span><br><span class="line">                qword_28A78,</span><br><span class="line">                qword_28A78,</span><br><span class="line">                qword_28B48,</span><br><span class="line">                qword_28C28,</span><br><span class="line">                <span class="number">19</span>,</span><br><span class="line">                qword_28A80);</span><br><span class="line"><span class="keyword">if</span> ( !qword_29688 )</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br></pre></td></tr></table></figure>

<p>将变量恢复一下符号（转成能看的样子）如下（来自<a target="_blank" rel="noopener" href="https://www.ctfiot.com/203459.html">2024年羊城杯粤港澳大湾区网络安全大赛WP-Reverse篇</a>）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// *** _Pyx_InitCachedConstants ***</span></span><br><span class="line"><span class="comment">// 元组赋值</span></span><br><span class="line">v1 = PyTuple_Pack(<span class="number">7LL</span>, self, x1, x2, tmp, low, high, ans);</span><br><span class="line"><span class="comment">// 我这边只显示了qword_28C98这个变量，但是汇编中可以看到更多变量（然而没有符号，这边抄的是手动恢复了符号的），恢复符号后的汇编如下：</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">.text:0000000000003AC0                 push    cs:ans</span></span><br><span class="line"><span class="comment">.text:0000000000003AC6                 mov     r9, cs:low</span></span><br><span class="line"><span class="comment">.text:0000000000003ACD                 xor     eax, eax</span></span><br><span class="line"><span class="comment">.text:0000000000003ACF                 mov     edi, 7</span></span><br><span class="line"><span class="comment">.text:0000000000003AD4                 mov     rsi, cs:self</span></span><br><span class="line"><span class="comment">.text:0000000000003ADB                 push    cs:high</span></span><br><span class="line"><span class="comment">.text:0000000000003AE1                 mov     r8, cs:tmp</span></span><br><span class="line"><span class="comment">.text:0000000000003AE8                 mov     rcx, cs:x2</span></span><br><span class="line"><span class="comment">.text:0000000000003AEF                 mov     rdx, cs:x1</span></span><br><span class="line"><span class="comment">.text:0000000000003AF6                 call    _PyTuple_Pack</span></span><br><span class="line"><span class="comment">.text:0000000000003AFB                 pop     rsi</span></span><br><span class="line"><span class="comment">.text:0000000000003AFC                 pop     rdi</span></span><br><span class="line"><span class="comment">.text:0000000000003AFD                 mov     cs:qword_29660, rax</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 手动恢复符号的方法为：</span></span><br><span class="line"><span class="comment">//（汇编中看到的数-_Pyx_CreateStringTabAndInitStrings中的起始位置）/8 = 索引</span></span><br><span class="line"><span class="comment">// 根据索引找string就行</span></span><br><span class="line"><span class="keyword">if</span> ( !v1 )</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line"><span class="comment">// 函数定义</span></span><br><span class="line">qword_29688 = _Pyx_PyCode_New_constprop_0(</span><br><span class="line">  <span class="number">3</span>, <span class="number">7</span>, qword_28A80, qword_28A78, qword_28A78, v1, qword_28A78, </span><br><span class="line">  qword_28A78, chal_py, p1, <span class="number">19</span>, qword_28A80</span><br><span class="line">);</span><br><span class="line"><span class="keyword">if</span> ( !qword_29688 )</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>_Pyx_PyCode_New_constprop_0</code>用于创建一个<code>PyCodeObject</code>，其参数就是<code>PyCodeObject</code>的各属性，具体可参考各版本cpython源码中对<code>PyCodeObject</code>的定义，这里就是以<code>v1</code>元组为参数+局部变量名（前<code>3</code>个为参数），原Python函数第一行在文件中的第<code>19</code>行（<code>qword_28A78</code>是<code>()</code>（空的tuple，见<code>_pyx_pymod_exec_chal</code>的第155行左右），<code>qword_28A80</code>是<code>&quot;&quot;</code>，无内容不用关注）创建了一个名为<code>_p1</code>的函数<code>PyCodeObject</code>，相当于是函数声明（因为<code>co_code</code>字段是空的，没有指定具体行为）。</p>
<p>PyCodeObject结构体的定义如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line"> PyObject_HEAD			   <span class="comment">/* 头部信息, 我们看到真的一切皆对象, 字节码也是个对象 */</span>	</span><br><span class="line"> <span class="type">int</span> co_argcount;            <span class="comment">/* 可以通过位置参数传递的参数个数 */</span></span><br><span class="line"> <span class="type">int</span> co_posonlyargcount;     <span class="comment">/* 只能通过位置参数传递的参数个数,  Python3.8新增 */</span></span><br><span class="line"> <span class="type">int</span> co_kwonlyargcount;      <span class="comment">/* 只能通过关键字参数传递的参数个数 */</span></span><br><span class="line"> <span class="type">int</span> co_nlocals;             <span class="comment">/* 代码块中局部变量的个数，也包括参数 */</span></span><br><span class="line"> <span class="type">int</span> co_stacksize;           <span class="comment">/* 执行该段代码块需要的栈空间 */</span></span><br><span class="line"> <span class="type">int</span> co_flags;               <span class="comment">/* 参数类型标识 */</span></span><br><span class="line"> <span class="type">int</span> co_firstlineno;         <span class="comment">/* 代码块在对应文件的行号 */</span></span><br><span class="line"> PyObject *co_code;          <span class="comment">/* 指令集, 也就是字节码, 它是一个bytes对象 */</span></span><br><span class="line"> PyObject *co_consts;        <span class="comment">/* 常量池, 一个元组，保存代码块中的所有常量。 */</span></span><br><span class="line"> PyObject *co_names;         <span class="comment">/* 一个元组,保存代码块中引用的其它作用域的变量 list of strings (names used) */</span></span><br><span class="line"> PyObject *co_varnames;      <span class="comment">/* 一个元组,保存当前作用域中的变量 tuple of strings (local variable names)*/</span></span><br><span class="line"> PyObject *co_freevars;      <span class="comment">/* 内层函数引用的外层函数的作用域中的变量 tuple of strings (free variable names)*/</span></span><br><span class="line"> PyObject *co_cellvars;      <span class="comment">/* 外层函数中作用域中被内层函数引用的变量，本质上和co_freevars是一样的 tuple of strings (cell variable names)*/</span></span><br><span class="line"></span><br><span class="line"> Py_ssize_t *co_cell2arg;    <span class="comment">/* 无需关注 */</span></span><br><span class="line"> PyObject *co_filename;      <span class="comment">/* 代码块所在的文件名 */</span></span><br><span class="line"> PyObject *co_name;          <span class="comment">/* 代码块的名字，通常是函数名或者类名 */</span></span><br><span class="line"> PyObject *co_lnotab;        <span class="comment">/* 字节码指令与python源代码的行号之间的对应关系，以PyByteObject的形式存在 */</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//剩下的无需关注了</span></span><br><span class="line"> <span class="type">void</span> *co_zombieframe;       <span class="comment">/* for optimization only (see frameobject.c) */</span></span><br><span class="line"> PyObject *co_weakreflist;   <span class="comment">/* to support weakrefs to code objects */</span></span><br><span class="line"> <span class="type">void</span> *co_extra;</span><br><span class="line"> <span class="type">unsigned</span> <span class="type">char</span> *co_opcache_map;</span><br><span class="line"> _PyOpcache *co_opcache;</span><br><span class="line"> <span class="type">int</span> co_opcache_flag; </span><br><span class="line"> <span class="type">unsigned</span> <span class="type">char</span> co_opcache_size; </span><br><span class="line">&#125; PyCodeObject;</span><br></pre></td></tr></table></figure>

<p>示例如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PyCode_New(</span><br><span class="line"><span class="number">0</span>,            <span class="comment">/*int argcount,*/</span></span><br><span class="line"><span class="number">0</span>,            <span class="comment">/*int kwonlyargcount,*/</span></span><br><span class="line"><span class="number">0</span>,            <span class="comment">/*int nlocals,*/</span></span><br><span class="line"><span class="number">0</span>,            <span class="comment">/*int stacksize,*/</span></span><br><span class="line"><span class="number">0</span>,            <span class="comment">/*int flags,*/</span></span><br><span class="line">empty_string, <span class="comment">/*PyObject *code,*/</span></span><br><span class="line">empty_tuple,  <span class="comment">/*PyObject *consts,*/</span></span><br><span class="line">empty_tuple,  <span class="comment">/*PyObject *names,*/</span></span><br><span class="line">empty_tuple,  <span class="comment">/*PyObject *varnames,*/</span></span><br><span class="line">empty_tuple,  <span class="comment">/*PyObject *freevars,*/</span></span><br><span class="line">empty_tuple,  <span class="comment">/*PyObject *cellvars,*/</span></span><br><span class="line">py_srcfile,   <span class="comment">/*PyObject *filename,*/</span></span><br><span class="line">py_funcname,  <span class="comment">/*PyObject *name,*/</span></span><br><span class="line">lineno,       <span class="comment">/*int firstlineno,*/</span></span><br><span class="line">empty_string  <span class="comment">/*PyObject *lnotab*/</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>


</blockquote>
<p>而根据对<code>_Pyx_PyCode_New_constprop_0</code>函数的结果（<code>qword_29688</code>）进行索引，可以在<code>_pyx_pymod_exec_chal</code>中找到</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v48 = _Pyx_CyFunction_New_constprop_0(&amp;_pyx_mdef_4chal_4chal_3_p1, qword_28B28, qword_28B18, _pyx_mstate_global_static, qword_29688);</span><br></pre></td></tr></table></figure>

<p>对应恢复符号后的结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v48 = _Pyx_CyFunction_New_constprop_0(&amp;_pyx_mdef_4chal_4chal_3_p1, chal__p1, chal, _pyx_mstate_global_static, qword_29688);</span><br></pre></td></tr></table></figure>

<p>而在这下面有</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v49 = (<span class="type">unsigned</span> <span class="type">int</span>)PyObject_SetItem(v7, qword_28C28, v48) &gt;&gt; <span class="number">31</span>;</span><br></pre></td></tr></table></figure>

<p>同样，对应恢复符号后的结果为</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v49 = PyObject_SetItem(v7, p1, v48) &gt;&gt; <span class="number">31</span>; <span class="comment">// self._p1 = v559</span></span><br></pre></td></tr></table></figure>

<p>（不知道为什么我这边解析出的变量名和WP有出入，不过基本上都对的上，这边改成了我的变量名了）</p>
<p>cython中一般使用<code>PyMethodDef</code>进行指定，PyMethodDef结构体源码（Include&#x2F;methodobject.h）如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> PyObject *(*PyCFunction)(PyObject *, PyObject *);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PyMethodDef</span> &#123;</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>  *ml_name;   <span class="comment">/* The name of the built-in function/method */</span></span><br><span class="line">    PyCFunction ml_meth;    <span class="comment">/* The C function that implements it */</span></span><br><span class="line">    <span class="type">int</span>         ml_flags;   <span class="comment">/* Combination of METH_xxx flags, which mostly</span></span><br><span class="line"><span class="comment">                               describe the args expected by the C func */</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>  *ml_doc;    <span class="comment">/* The __doc__ attribute, or NULL */</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">PyMethodDef</span> <span class="title">PyMethodDef</span>;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>PyMethodDef 是一个 C结构体，用来完成一个映射，也就是便于方法查找，我们把<strong>需要被外面调用的方法</strong>都记录在这表内。</p>
<p><strong>PyMethodDef</strong> 结构体成员说明：</p>
<ol>
<li>第一个字段：在 Python 里面使用的方法名；</li>
<li>第二个字段：C 模块内的函数名（已经实现了的函数名）；（IDA中可以由此找到函数体所在的位置）</li>
<li>第三个字段：方法参数类型，是无参数(METH_NOARGS) , 还是有位置参数(METH_VARARGS), 还是其他等等；</li>
<li>第四个字段：方法描述，就是通过 <strong>help()</strong> 或者 <strong>doc</strong> 可以看到的；</li>
</ol>
<p>正因为存在这样的一份记录表，Python 才能够寻找到相应的函数</p>
</blockquote>
<p>伪代码中的<code>_pyx_mdef_4chal_4chal_3_p1</code>就是一个<code>PyMethodDef</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.data:00000000000289C0 __pyx_mdef_4chal_4chal_3_p1 dq offset aChalChalP1+0Ah</span><br><span class="line">.data:00000000000289C0                                         ; DATA XREF: __pyx_pymod_exec_chal+236B↑o</span><br><span class="line">.data:00000000000289C0                                         ; &quot;_p1&quot;</span><br><span class="line">.data:00000000000289C8                 dq offset __pyx_pw_4chal_4chal_3_p1</span><br><span class="line">.data:00000000000289D0                 db  82h</span><br><span class="line">.data:00000000000289D1                 db    0</span><br></pre></td></tr></table></figure>

<p><code>_p1</code>的函数体实际上在<code>__pyx_pw_4chal_4chal_3_p1</code>中。</p>
<h4 id="import"><a href="#import" class="headerlink" title="import"></a>import</h4><p>在函数<code>_pyx_pymod_exec_chal</code>中</p>
<p>可以找到如下内容：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">v22 = _Pyx_ImportDottedModule_constprop_0(qword_28C70);</span><br><span class="line">v7 = v22;</span><br><span class="line"><span class="keyword">if</span> ( !v22 )</span><br><span class="line">&#123;</span><br><span class="line">    v32 = <span class="number">0LL</span>;</span><br><span class="line">    v2 = <span class="number">0LL</span>;</span><br><span class="line">    v33 = <span class="number">10315</span>;</span><br><span class="line">    v35 = <span class="number">1</span>;</span><br><span class="line">    v34 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_349;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过手动恢复符号，可以发现<code>qword_28C70</code>对应的字符串为<code>&quot;random&quot;</code>，说明其对应的就是python中的<code>import random</code>的操作</p>
<h3 id="Python代码的转译"><a href="#Python代码的转译" class="headerlink" title="Python代码的转译"></a>Python代码的转译</h3><h4 id="对象变量赋值"><a href="#对象变量赋值" class="headerlink" title="对象变量赋值"></a>对象变量赋值</h4><p>在函数<code>_pyx_pw_4chal_4chal_1__init__</code>中，第358行左右，可以找到如下内容：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v22 = PyObject_SetAttr(v19, qword_28D50, v20); <span class="comment">// qword_28D50 = &quot;_var1&quot;</span></span><br></pre></td></tr></table></figure>

<p>直接用了<code>PyObject_SetAttr</code>函数，其实反编译过来就是<code>self._var1 = v20</code>。</p>
<h4 id="数组赋值"><a href="#数组赋值" class="headerlink" title="数组赋值"></a>数组赋值</h4><p>在函数<code>_pyx_pw_4chal_4chal_1__init__</code>中，第369行左右，可以找到如下内容：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">v23 = (__int64 *)PyList_New(<span class="number">32LL</span>);</span><br><span class="line"><span class="keyword">if</span> ( !v23 )</span><br><span class="line">&#123;</span><br><span class="line">  v107 = <span class="number">0LL</span>;</span><br><span class="line">  v95 = <span class="number">0LL</span>;</span><br><span class="line">  Attr = <span class="number">0LL</span>;</span><br><span class="line">  v126 = <span class="number">4234LL</span>;</span><br><span class="line">  v127 = <span class="number">7LL</span>;</span><br><span class="line">  <span class="keyword">goto</span> LABEL_211;</span><br><span class="line">&#125;</span><br><span class="line">v24 = qword_291B0; <span class="comment">// qword_291B0 = PyLong_FromLong(121LL);</span></span><br><span class="line"><span class="keyword">if</span> ( *(_DWORD *)qword_291B0 != <span class="number">-1</span> )</span><br><span class="line">  ++*(_DWORD *)qword_291B0;</span><br><span class="line">v25 = (__int64 *)v23[<span class="number">3</span>];</span><br><span class="line">*v25 = v24;</span><br><span class="line"><span class="comment">// 重复v24 = qword_291B0;到*v25 = v24;这几步处理对列表赋值</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// 最后来到这</span></span><br><span class="line">v58 = *(__int64 (__fastcall **)(__int64, __int64, __int64 *))(*(_QWORD *)(v19 + <span class="number">8</span>) + <span class="number">152LL</span>);</span><br><span class="line"><span class="keyword">if</span> ( v58 )</span><br><span class="line">  v59 = v58(v19, qword_28D60, v23);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  v59 = PyObject_SetAttr(v19, qword_28D60, v23); <span class="comment">// 重点是这步qword_28D60 = &quot;_var2&quot;</span></span><br></pre></td></tr></table></figure>

<p>即最后将成型的列表<code>v23</code>赋给<code>self._var2</code>，这里还原后的结果就是<code>self._var2 = v23 = [121, ...]</code></p>
<h4 id="参数解析"><a href="#参数解析" class="headerlink" title="参数解析"></a>参数解析</h4><p>在函数<code>_pyx_pw_4chal_4chal_1__init__</code>可以找到如下内容：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">v15 = *(_QWORD *)(a4 + <span class="number">16</span>);</span><br><span class="line">v210 = _mm_loadu_si128(a2); <span class="comment">// 使用xmm寄存器存储参数</span></span><br><span class="line">LABEL_207:</span><br><span class="line">  <span class="keyword">if</span> ( v15 &gt; <span class="number">0</span> &amp;&amp; (<span class="type">int</span>)_Pyx_ParseOptionalKeywords_constprop_0(a4, v6, &amp;v211, &amp;v210, a3, <span class="string">&quot;__init__&quot;</span>) &lt; <span class="number">0</span> ) <span class="comment">// 解析__init__函数的参数，存放的位置为v210</span></span><br><span class="line">  &#123;</span><br><span class="line">    v16 = <span class="number">4153</span>;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_21;</span><br><span class="line">  &#125;</span><br><span class="line">  v20 = v210.m128i_i64[<span class="number">1</span>];	<span class="comment">// 参数1给了v20</span></span><br><span class="line">  v19 = v210.m128i_i64[<span class="number">0</span>];	<span class="comment">// 参数0给了v19</span></span><br><span class="line">LABEL_26:</span><br><span class="line">  v21 = *(__int64 (__fastcall **)(__int64, __int64))(*(_QWORD *)(v19 + <span class="number">8</span>) + <span class="number">152LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v21 )</span><br><span class="line">    v22 = v21(v19, var1);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v22 = PyObject_SetAttr(v19, var1, v20); <span class="comment">// 这个就是上面的赋值</span></span><br></pre></td></tr></table></figure>

<p>这是对<code>__init__</code>函数传入参数的解析，解析的结果赋值给其他变量</p>
<h4 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h4><p>在进行函数调用的例子之前，需要</p>
<p>在函数<code>_pyx_pw_4chal_4chal_1__init__</code>的第940行左右，是一段如果参数为变量对Python函数的完整调用，没有标注的都是框架代码及错误处理。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">v159 = *(__int64 (__fastcall **)(__int64, __int64))(*(_QWORD *)(v19 + <span class="number">8</span>) + <span class="number">144LL</span>);</span><br><span class="line"><span class="comment">// v19 = a2-&gt;m128i_i64[0]; 分析后应该是self</span></span><br><span class="line"><span class="keyword">if</span> ( v159 )</span><br><span class="line">  v95 = v159(v19, qword_28C38); <span class="comment">// v95 = self._p3其中qword_28C38 = &quot;_p3&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  v95 = PyObject_GetAttr(v19, qword_28C38); <span class="comment">// v95 = self._p3其中qword_28C38 = &quot;_p3&quot;</span></span><br><span class="line"><span class="keyword">if</span> ( !v95 )</span><br><span class="line">&#123;</span><br><span class="line">  v107 = <span class="number">0LL</span>;</span><br><span class="line">  Attr = <span class="number">0LL</span>;</span><br><span class="line">  v23 = <span class="number">0LL</span>;</span><br><span class="line">  v126 = <span class="number">4493LL</span>;</span><br><span class="line">  v127 = <span class="number">10LL</span>;</span><br><span class="line">  <span class="keyword">goto</span> LABEL_211;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( *(_UNKNOWN **)(v95 + <span class="number">8</span>) == &amp;PyMethod_Type &amp;&amp; (v161 = *(_DWORD **)(v95 + <span class="number">24</span>)) != <span class="number">0LL</span> )</span><br><span class="line">&#123;</span><br><span class="line">  Attr = *(_QWORD **)(v95 + <span class="number">16</span>); <span class="comment">// Attr = v95</span></span><br><span class="line">  <span class="keyword">if</span> ( *v161 != <span class="number">-1</span> )</span><br><span class="line">    ++*v161;</span><br><span class="line">  <span class="keyword">if</span> ( *(_DWORD *)Attr != <span class="number">-1</span> )</span><br><span class="line">    ++*(_DWORD *)Attr;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">int</span>)*(_QWORD *)v95 &gt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v162 = *(_QWORD *)v95 - <span class="number">1LL</span>;</span><br><span class="line">    *(_QWORD *)v95 = v162;</span><br><span class="line">    <span class="keyword">if</span> ( !v162 )</span><br><span class="line">      _Py_Dealloc(v95, v158, v160);</span><br><span class="line">  &#125;</span><br><span class="line">  v163 = &amp;v211;</span><br><span class="line">  v211 = _mm_loadh_ps((<span class="type">const</span> <span class="type">double</span> *)&amp;qword_28AA0); <span class="comment">// 这个地方是参数，qword_28AA0 = &quot;Don&#x27;t hook!!!&quot;</span></span><br><span class="line">  v23 = (__int64 *)_Pyx_PyObject_FastCallDict_constprop_0(Attr, &amp;v211, <span class="number">2LL</span>);<span class="comment">// 函数调用，执行self._p3(&quot;Don&#x27;t hook!!!&quot;)，返回值给v23</span></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">int</span>)*(_QWORD *)v161 &gt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v165 = *(_QWORD *)v161 - <span class="number">1LL</span>;</span><br><span class="line">    *(_QWORD *)v161 = v165;</span><br><span class="line">    <span class="keyword">if</span> ( !v165 )</span><br><span class="line">      _Py_Dealloc(v161, &amp;v211, v164);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 不同的调用方式，和上面的if同层</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  Attr = (_QWORD *)v95;</span><br><span class="line">  v163 = v206;</span><br><span class="line">  v211.m128_u64[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v211.m128_u64[<span class="number">1</span>] = qword_28AA0; <span class="comment">// qword_28AA0 = &quot;Don&#x27;t hook!!!&quot;&quot;</span></span><br><span class="line">  v23 = (__int64 *)_Pyx_PyObject_FastCallDict_constprop_0(v95, v206, <span class="number">1LL</span>);<span class="comment">// 函数调用，执行self._p3(&quot;Don&#x27;t hook!!!&quot;)，返回值给v23</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( !v23 )</span><br><span class="line">&#123;</span><br><span class="line">  v107 = <span class="number">0LL</span>;</span><br><span class="line">  v95 = <span class="number">0LL</span>;</span><br><span class="line">  v126 = <span class="number">4513LL</span>;</span><br><span class="line">  v127 = <span class="number">10LL</span>;</span><br><span class="line">  <span class="keyword">goto</span> LABEL_211;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( (<span class="type">int</span>)*Attr &gt;= <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">  v166 = *Attr - <span class="number">1LL</span>;</span><br><span class="line">  *Attr = v166;</span><br><span class="line">  <span class="keyword">if</span> ( !v166 )</span><br><span class="line">    _Py_Dealloc(Attr, v163, v164);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果参数都为常量则简单得多（在函数<code>_pyx_pf_4chal_4chal_6_p3_isra_0</code>中的第5169行左右，反编译这个函数要<a target="_blank" rel="noopener" href="https://blog.csdn.net/counsellor/article/details/125882904">改IDA的允许反编译的最大大小</a>）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">v420 = (__m128 *)_Pyx_PyObject_GetAttrStr((__int64)v419, to_bytes); <span class="comment">// 重点</span></span><br><span class="line">BuiltinName = v420;</span><br><span class="line">v421 = (__int64 *)v420;</span><br><span class="line"><span class="keyword">if</span> ( !v420 )</span><br><span class="line">&#123;</span><br><span class="line">  v1296 = <span class="number">7153</span>;</span><br><span class="line">  v436 = v1256;</span><br><span class="line">  v437 = <span class="number">0LL</span>;</span><br><span class="line">  v21 = (__int64 *)v1347;</span><br><span class="line">  <span class="keyword">goto</span> LABEL_863;</span><br><span class="line">&#125;</span><br><span class="line">v422 = qword_29648;</span><br><span class="line">v424 = (__m128 *)_Pyx_PyObject_Call_constprop_0(v420, qword_29648); <span class="comment">// 重点，qword_29648是元组，存储的信息是(2,&#x27;little&#x27;)，在_Pyx_InitCachedConstants中有初始化</span></span><br><span class="line"><span class="keyword">if</span> ( !v424 )</span><br><span class="line">&#123;</span><br><span class="line">  v1296 = <span class="number">7155</span>;</span><br><span class="line">  v436 = v1256;</span><br><span class="line">  v437 = <span class="number">0LL</span>;</span><br><span class="line">  v21 = (__int64 *)v1347;</span><br><span class="line">  <span class="keyword">goto</span> LABEL_863;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( (<span class="type">int</span>)*v421 &gt;= <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">  v425 = *v421 - <span class="number">1</span>;</span><br><span class="line">  *v421 = v425;</span><br><span class="line">  <span class="keyword">if</span> ( !v425 )</span><br><span class="line">    _Py_Dealloc(v421, v422, v423);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>等同于Python中的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v422 = v419.to_bytes(<span class="number">2</span>, <span class="string">&#x27;little&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h4><p>在函数<code>_pyx_pf_4chal_4chal_6_p3_isra_0</code>中的第998行左右可以找到如下内容</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// v95 = self._var2</span></span><br><span class="line">v167 = *(__int64 (__fastcall **)(__int64, __int64))(*(_QWORD *)(v19 + <span class="number">8</span>) + <span class="number">144LL</span>);</span><br><span class="line"><span class="keyword">if</span> ( v167 )</span><br><span class="line">  v95 = v167(v19, var2);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  v95 = PyObject_GetAttr(v19, var2); <span class="comment">// 重点</span></span><br><span class="line"><span class="keyword">if</span> ( !v95 )</span><br><span class="line">&#123;</span><br><span class="line">  v107 = <span class="number">0LL</span>;</span><br><span class="line">  Attr = <span class="number">0LL</span>;</span><br><span class="line">  v126 = <span class="number">4527LL</span>;</span><br><span class="line">  v127 = <span class="number">12LL</span>;</span><br><span class="line">  <span class="keyword">goto</span> LABEL_211;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 上文返回值v23和v2对比，对比常量：</span></span><br><span class="line"><span class="comment">https://github.com/python/cpython/blob/3.12/Include/object.h#L862</span></span><br><span class="line"><span class="comment">#define Py_LT 0 小于</span></span><br><span class="line"><span class="comment">#define Py_LE 1 小于等于</span></span><br><span class="line"><span class="comment">#define Py_EQ 2 等于</span></span><br><span class="line"><span class="comment">#define Py_NE 3	不等于</span></span><br><span class="line"><span class="comment">#define Py_GT 4 大于</span></span><br><span class="line"><span class="comment">#define Py_GE 5 大于等于</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Attr = (_QWORD *)PyObject_RichCompare(v23, v95, <span class="number">2LL</span>); <span class="comment">// 重点</span></span><br><span class="line"><span class="keyword">if</span> ( !Attr )</span><br><span class="line">&#123;</span><br><span class="line">  v128 = v23;</span><br><span class="line">  v126 = <span class="number">4529LL</span>;</span><br><span class="line">  v23 = (__int64 *)v95;</span><br><span class="line">  v127 = <span class="number">12LL</span>;</span><br><span class="line">  <span class="keyword">goto</span> LABEL_246;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( (<span class="type">int</span>)*(_QWORD *)v95 &gt;= <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">  v169 = *(_QWORD *)v95 - <span class="number">1LL</span>;</span><br><span class="line">  *(_QWORD *)v95 = v169;</span><br><span class="line">  <span class="keyword">if</span> ( !v169 )</span><br><span class="line">    _Py_Dealloc(v95, v95, v168);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 确定是否IsTrue</span></span><br><span class="line">LOBYTE(IsTrue) = Attr == (_QWORD *)&amp;Py_TrueStruct;<span class="comment">// 重点</span></span><br><span class="line"><span class="keyword">if</span> ( Attr == (_QWORD *)&amp;Py_TrueStruct || Attr == (_QWORD *)&amp;Py_FalseStruct || Attr == (_QWORD *)&amp;Py_NoneStruct )</span><br><span class="line">&#123;</span><br><span class="line">  IsTrue = (<span class="type">unsigned</span> __int8)IsTrue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  IsTrue = PyObject_IsTrue(Attr);</span><br><span class="line">  <span class="keyword">if</span> ( IsTrue &lt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v126 = <span class="number">4531LL</span>;</span><br><span class="line">    v127 = <span class="number">12LL</span>;</span><br><span class="line">    v107 = <span class="number">0LL</span>;</span><br><span class="line">    v95 = <span class="number">0LL</span>;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_211;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( (<span class="type">int</span>)*Attr &gt;= <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">  v171 = *Attr - <span class="number">1LL</span>;</span><br><span class="line">  *Attr = v171;</span><br><span class="line">  <span class="keyword">if</span> ( !v171 )</span><br><span class="line">    _Py_Dealloc(Attr, v95, v168);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 如果not IsTrue，即 v23 != self._var2</span></span><br><span class="line"><span class="keyword">if</span> ( !IsTrue )</span><br></pre></td></tr></table></figure>

<h4 id="取数组长度"><a href="#取数组长度" class="headerlink" title="取数组长度"></a>取数组长度</h4><p>在函数<code>_pyx_pf_4chal_4chal_6_p3_isra_0</code>中的第670行左右可以找到如下内容</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">v94 = *(__int64 (__fastcall **)(__int64, __int64))(*(_QWORD *)(v19 + <span class="number">8</span>) + <span class="number">144LL</span>);<span class="comment">// (v19 + 8) == &#x27;self&#x27;</span></span><br><span class="line">  <span class="keyword">if</span> ( v94 )</span><br><span class="line">    v95 = v94(v19, var1);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v95 = PyObject_GetAttr(v19, var1);<span class="comment">// 重点</span></span><br><span class="line">  <span class="keyword">if</span> ( !v95 )</span><br><span class="line">  &#123;</span><br><span class="line">    v107 = <span class="number">0LL</span>;</span><br><span class="line">    v23 = <span class="number">0LL</span>;</span><br><span class="line">    v126 = <span class="number">4407LL</span>;</span><br><span class="line">    v127 = <span class="number">9LL</span>;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_211;</span><br><span class="line">  &#125;</span><br><span class="line">  v96 = PyObject_Size(v95); <span class="comment">// 重点</span></span><br><span class="line">  <span class="keyword">if</span> ( v96 == <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v23 = (__int64 *)v95;</span><br><span class="line">    v126 = <span class="number">4409LL</span>;</span><br><span class="line">    v107 = <span class="number">0LL</span>;</span><br><span class="line">    v100 = <span class="number">0LL</span>;</span><br><span class="line">    v95 = <span class="number">0LL</span>;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_254;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">int</span>)*(_QWORD *)v95 &gt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v97 = *(_QWORD *)v95 - <span class="number">1LL</span>;</span><br><span class="line">    *(_QWORD *)v95 = v97;</span><br><span class="line">    <span class="keyword">if</span> ( !v97 )</span><br><span class="line">      _Py_Dealloc(v95, v93, v90);</span><br><span class="line">  &#125;</span><br><span class="line">  v98 = PyLong_FromSsize_t(v96); <span class="comment">// 重点</span></span><br><span class="line">  v95 = v98;</span><br><span class="line">  <span class="keyword">if</span> ( !v98 )</span><br><span class="line">  &#123;</span><br><span class="line">    v107 = <span class="number">0LL</span>;</span><br><span class="line">    v23 = <span class="number">0LL</span>;</span><br><span class="line">    v126 = <span class="number">4411LL</span>;</span><br><span class="line">    v127 = <span class="number">9LL</span>;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_211;</span><br><span class="line">  &#125;</span><br><span class="line">  v99 = v98;</span><br></pre></td></tr></table></figure>

<p>这一段实际上等同于Python中的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v93 = <span class="built_in">len</span>(self._var1)</span><br></pre></td></tr></table></figure>

<h4 id="运算"><a href="#运算" class="headerlink" title="运算"></a>运算</h4><p>以下函数均在<code>_pyx_pf_4chal_4chal_6_p3_isra_0</code>中可以找到</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// v100 = 2654435769 - v98</span></span><br><span class="line">v100 = PyNumber_Subtract(pyx_int_2654435769, v98);</span><br><span class="line"><span class="comment">// v107 = v23 + v95</span></span><br><span class="line">v107 = PyNumber_Add(v23, v95);</span><br><span class="line"><span class="comment">// v303 = v302 ^ v93</span></span><br><span class="line">v303 = (__m128 *)PyNumber_Xor(v302, v93);</span><br><span class="line"><span class="comment">// v379 = v1338 + v377</span></span><br><span class="line">v379 = (__int64 *)PyNumber_Add(v1338, v377);</span><br><span class="line"><span class="comment">// InPlace字样，这里等同于v1322 = (v509 &amp;= 4294967295)</span></span><br><span class="line">v1322 = (__m128 *)PyNumber_InPlaceAnd(v509, pyx_int_4294967295);</span><br><span class="line"><span class="comment">// Slice_constprop_0 = v1322 &gt;&gt; 4</span></span><br><span class="line">Slice_constprop_0 = (__m128 *)_Pyx_PyInt_RshiftObjC_constprop_0(v1322, pyx_int_4, <span class="number">4LL</span>);</span><br><span class="line"><span class="comment">// v569 = v1334 &amp; 3 （有时候会出现0xFFFF，猜测是当成掩码了）</span></span><br><span class="line">v569 = (__m128 *)_Pyx_PyInt_AndObjC_constprop_0(v1334, pyx_int_3, <span class="number">3LL</span>, <span class="number">0LL</span>);</span><br><span class="line"><span class="comment">// ItemInt_List_Fast_constprop_0 = v569 + 4</span></span><br><span class="line">ItemInt_List_Fast_constprop_0 = (__m128 *)_Pyx_PyInt_AddObjC_constprop_0(v569, pyx_int_4, <span class="number">4LL</span>, <span class="number">0LL</span>);</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>

<h3 id="HOOK辅助"><a href="#HOOK辅助" class="headerlink" title="HOOK辅助"></a>HOOK辅助</h3><p>使用x86_64机器上的Python 3.12导入chal，即可对其函数进行hook。如我们需要hook<code>self._p1</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> chal</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">setattr</span>(chal.chal, <span class="string">&quot;ori_p1&quot;</span>, chal.chal.__dict__[<span class="string">&quot;_p1&quot;</span>]) <span class="comment"># 保存原来的_p1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">hook_p1</span>(<span class="params">self, a, b</span>): <span class="comment"># 写hook函数，打印参数和返回值</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(a, b)</span><br><span class="line"><span class="meta">... </span>    ret = self.ori_p1(a, b)</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(ret)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> ret</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">setattr</span>(chal.chal, <span class="string">&quot;_p1&quot;</span>, hook_p1) <span class="comment"># 挂上去</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>chal.chal(<span class="string">&quot;a&quot;</span>) <span class="comment"># 调用后即可看到每次调用self._p1时的参数和返回值，且不影响函数原来的功能</span></span><br><span class="line"><span class="number">52232</span> <span class="number">48895</span></span><br><span class="line">-<span class="number">27712</span></span><br><span class="line"><span class="number">52883</span> <span class="number">49898</span></span><br><span class="line">-<span class="number">25833</span></span><br><span class="line"><span class="number">64660</span> <span class="number">29775</span></span><br><span class="line">-<span class="number">28948</span></span><br><span class="line"><span class="comment"># ... 数据省略</span></span><br></pre></td></tr></table></figure>

<p>hook出中间数据以后可以帮助我们确认或纠正在静态手工反编译过程中的一些细节，如这里hook出<code>self._p1</code>的中间数据后，如果我们恢复出的源代码中的<code>self._p1</code>的中间数据与此相同，那么可以保证流程走到<code>self._p1</code>时其参数和返回值一定是正确的；反之则说明恢复的源代码有误。</p>
<p>在本题中，hook<code>self._p1</code>可以确认输入数据流的加密是否正确；hook<code>self._p2</code>可以确认随机数是否相同，从而确认随机数种子及使用random模块中函数的次数是否一致；hook<code>self._p3</code>可以拿到被<code>self._p3</code>改变但未被<code>self.__init__</code>改变的<code>self.tips</code>，确认比对的细节。</p>
<h3 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h3><p>用上面的这些方法就可以将so文件里面的内容恢复成python源码了</p>
<p>这边建议先根据<code>_Pyx_CreateStringTabAndInitStrings</code>函数将符号变量什么的恢复出来，方便后面分析</p>
<p>同时，可以搜索一下特别长的数组，说不定能搜出来用了什么加密</p>
<p>重点要用于参考的函数有：<code>_pyx_pw_4chal_4chal_1__init__</code>（int以及杂项内容的初始化）、<code>_Pyx_CreateStringTabAndInitStrings</code>（各种字符串的索引）、<code>_Pyx_InitCachedConstants</code>（函数与一些元组的初始化）、<code>_pyx_pf_4chal_4chal_6_p3_isra_0</code>（p3函数的函数体）</p>
<p>其中在<code>_pyx_pf_4chal_4chal_6_p3_isra_0</code>中，需要交叉索引<code>_Pyx_GetItemInt_List_Fast_constprop_0</code>，这个函数代表着取数组内容，对分析很有帮助（特别是代码已经到了一万行的情况下）</p>
<p>还原的代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">chal</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, i</span>):</span><br><span class="line">        self.var1 = i</span><br><span class="line">        self.var2 = [<span class="number">121</span>, <span class="number">73</span>, <span class="number">141</span>, <span class="number">146</span>, <span class="number">115</span>, <span class="number">230</span>, <span class="number">181</span>, <span class="number">65</span>, <span class="number">238</span>, <span class="number">17</span>, <span class="number">146</span>, <span class="number">73</span>, <span class="number">228</span>, <span class="number">82</span>, <span class="number">188</span>, <span class="number">66</span>, <span class="number">12</span>, <span class="number">148</span>, <span class="number">225</span>, <span class="number">66</span>, <span class="number">255</span>, <span class="number">254</span>, <span class="number">47</span>, <span class="number">22</span>, <span class="number">163</span>, <span class="number">250</span>, <span class="number">222</span>, <span class="number">133</span>, <span class="number">35</span>, <span class="number">232</span>, <span class="number">106</span>, <span class="number">176</span>]</span><br><span class="line">        self.var3 = [<span class="number">12</span>, <span class="number">243</span>, <span class="number">133</span>, <span class="number">147</span>, <span class="number">7</span>, <span class="number">36</span>, <span class="number">29</span>, <span class="number">49</span>, <span class="number">226</span>, <span class="number">211</span>, <span class="number">156</span>, <span class="number">56</span>, <span class="number">142</span>, <span class="number">78</span>, <span class="number">254</span>, <span class="number">12</span>]</span><br><span class="line">        random.seed(<span class="built_in">sum</span>([<span class="number">2654435769</span>-<span class="built_in">len</span>(i)] + [<span class="built_in">ord</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">str</span>(<span class="built_in">len</span>(i))]))</span><br><span class="line">        <span class="keyword">if</span> self._p3(<span class="string">&quot;Don&#x27;t Hook!!!&quot;</span>) == self.var2:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;yes&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> self.tips == <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># 这里有个 self.var2 + self.var3 没用上</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;yes&quot;</span>)</span><br><span class="line">        self.tips = <span class="string">&quot;Don&#x27;t peek!!!&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_p1</span>(<span class="params">self,x1,x2</span>):</span><br><span class="line">        c = x1 * x2</span><br><span class="line">        cl = c &amp; <span class="number">0xFFFF</span></span><br><span class="line">        ch = (c&gt;&gt;<span class="number">16</span>) &amp; <span class="number">0xFFFF</span></span><br><span class="line">        <span class="keyword">if</span> (cl-ch)&lt;<span class="number">0</span>:</span><br><span class="line">            ret = cl - ch + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret = cl - ch</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_p2</span>(<span class="params">self,i</span>):</span><br><span class="line">        <span class="comment"># sm4 subbytes</span></span><br><span class="line">        l = [<span class="number">214</span>, <span class="number">144</span>, <span class="number">233</span>, <span class="number">254</span>, <span class="number">204</span>, <span class="number">225</span>, <span class="number">61</span>, <span class="number">183</span>, <span class="number">22</span>, <span class="number">182</span>, <span class="number">20</span>, <span class="number">194</span>, <span class="number">40</span>, <span class="number">251</span>, <span class="number">44</span>, <span class="number">5</span>, <span class="number">43</span>, <span class="number">103</span>, <span class="number">154</span>, <span class="number">118</span>, <span class="number">42</span>, <span class="number">190</span>, <span class="number">4</span>, <span class="number">195</span>, <span class="number">170</span>, <span class="number">68</span>, <span class="number">19</span>, <span class="number">38</span>, <span class="number">73</span>, <span class="number">134</span>, <span class="number">6</span>, <span class="number">153</span>, <span class="number">156</span>, <span class="number">66</span>, <span class="number">80</span>, <span class="number">244</span>, <span class="number">145</span>, <span class="number">239</span>, <span class="number">152</span>, <span class="number">122</span>, <span class="number">51</span>, <span class="number">84</span>, <span class="number">11</span>, <span class="number">67</span>, <span class="number">237</span>, <span class="number">207</span>, <span class="number">172</span>, <span class="number">98</span>, <span class="number">228</span>, <span class="number">179</span>, <span class="number">28</span>, <span class="number">169</span>, <span class="number">201</span>, <span class="number">8</span>, <span class="number">232</span>, <span class="number">149</span>, <span class="number">128</span>, <span class="number">223</span>, <span class="number">148</span>, <span class="number">250</span>, <span class="number">117</span>, <span class="number">143</span>, <span class="number">63</span>, <span class="number">166</span>, <span class="number">71</span>, <span class="number">7</span>, <span class="number">167</span>, <span class="number">252</span>, <span class="number">243</span>, <span class="number">115</span>, <span class="number">23</span>, <span class="number">186</span>, <span class="number">131</span>, <span class="number">89</span>, <span class="number">60</span>, <span class="number">25</span>, <span class="number">230</span>, <span class="number">133</span>, <span class="number">79</span>, <span class="number">168</span>, <span class="number">104</span>, <span class="number">107</span>, <span class="number">129</span>, <span class="number">178</span>, <span class="number">113</span>, <span class="number">100</span>, <span class="number">218</span>, <span class="number">139</span>, <span class="number">248</span>, <span class="number">235</span>, <span class="number">15</span>, <span class="number">75</span>, <span class="number">112</span>, <span class="number">86</span>, <span class="number">157</span>, <span class="number">53</span>, <span class="number">30</span>, <span class="number">36</span>, <span class="number">14</span>, <span class="number">94</span>, <span class="number">99</span>, <span class="number">88</span>, <span class="number">209</span>, <span class="number">162</span>, <span class="number">37</span>, <span class="number">34</span>, <span class="number">124</span>, <span class="number">59</span>, <span class="number">1</span>, <span class="number">33</span>, <span class="number">120</span>, <span class="number">135</span>, <span class="number">212</span>, <span class="number">0</span>, <span class="number">70</span>, <span class="number">87</span>, <span class="number">159</span>, <span class="number">211</span>, <span class="number">39</span>, <span class="number">82</span>, <span class="number">76</span>, <span class="number">54</span>, <span class="number">2</span>, <span class="number">231</span>, <span class="number">160</span>, <span class="number">196</span>, <span class="number">200</span>, <span class="number">158</span>, <span class="number">234</span>, <span class="number">191</span>, <span class="number">138</span>, <span class="number">210</span>, <span class="number">64</span>, <span class="number">199</span>, <span class="number">56</span>, <span class="number">181</span>, <span class="number">163</span>, <span class="number">247</span>, <span class="number">242</span>, <span class="number">206</span>, <span class="number">249</span>, <span class="number">97</span>, <span class="number">21</span>, <span class="number">161</span>, <span class="number">224</span>, <span class="number">174</span>, <span class="number">93</span>, <span class="number">164</span>, <span class="number">155</span>, <span class="number">52</span>, <span class="number">26</span>, <span class="number">85</span>, <span class="number">173</span>, <span class="number">147</span>, <span class="number">50</span>, <span class="number">48</span>, <span class="number">245</span>, <span class="number">140</span>, <span class="number">177</span>, <span class="number">227</span>, <span class="number">29</span>, <span class="number">246</span>, <span class="number">226</span>, <span class="number">46</span>, <span class="number">130</span>, <span class="number">102</span>, <span class="number">202</span>, <span class="number">96</span>, <span class="number">192</span>, <span class="number">41</span>, <span class="number">35</span>, <span class="number">171</span>, <span class="number">13</span>, <span class="number">83</span>, <span class="number">78</span>, <span class="number">111</span>, <span class="number">213</span>, <span class="number">219</span>, <span class="number">55</span>, <span class="number">69</span>, <span class="number">222</span>, <span class="number">253</span>, <span class="number">142</span>, <span class="number">47</span>, <span class="number">3</span>, <span class="number">255</span>, <span class="number">106</span>, <span class="number">114</span>, <span class="number">109</span>, <span class="number">108</span>, <span class="number">91</span>, <span class="number">81</span>, <span class="number">141</span>, <span class="number">27</span>, <span class="number">175</span>, <span class="number">146</span>, <span class="number">187</span>, <span class="number">221</span>, <span class="number">188</span>, <span class="number">127</span>, <span class="number">17</span>, <span class="number">217</span>, <span class="number">92</span>, <span class="number">65</span>, <span class="number">31</span>, <span class="number">16</span>, <span class="number">90</span>, <span class="number">216</span>, <span class="number">10</span>, <span class="number">193</span>, <span class="number">49</span>, <span class="number">136</span>, <span class="number">165</span>, <span class="number">205</span>, <span class="number">123</span>, <span class="number">189</span>, <span class="number">45</span>, <span class="number">116</span>, <span class="number">208</span>, <span class="number">18</span>, <span class="number">184</span>, <span class="number">229</span>, <span class="number">180</span>, <span class="number">176</span>, <span class="number">137</span>, <span class="number">105</span>, <span class="number">151</span>, <span class="number">74</span>, <span class="number">12</span>, <span class="number">150</span>, <span class="number">119</span>, <span class="number">126</span>, <span class="number">101</span>, <span class="number">185</span>, <span class="number">241</span>, <span class="number">9</span>, <span class="number">197</span>, <span class="number">110</span>, <span class="number">198</span>, <span class="number">132</span>, <span class="number">24</span>, <span class="number">240</span>, <span class="number">125</span>, <span class="number">236</span>, <span class="number">58</span>, <span class="number">220</span>, <span class="number">77</span>, <span class="number">32</span>, <span class="number">121</span>, <span class="number">238</span>, <span class="number">95</span>, <span class="number">62</span>, <span class="number">215</span>, <span class="number">203</span>, <span class="number">57</span>, <span class="number">72</span>]</span><br><span class="line">        ret = <span class="built_in">int</span>.from_bytes(<span class="built_in">bytes</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: l[x], i.to_bytes(<span class="number">4</span>, <span class="string">&#x27;little&#x27;</span>))), <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_p3</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 开头的lambda是个pkcs5padding，但是输入整块的数据就不重要了（块长度是16</span></span><br><span class="line">        <span class="comment"># s = pkcs5padding(self.var1).encode()</span></span><br><span class="line">        s = self.var1.encode()</span><br><span class="line">        L = [<span class="number">173</span>, <span class="number">7</span>, <span class="number">131</span>, <span class="number">63</span>, <span class="number">141</span>, <span class="number">180</span>, <span class="number">193</span>, <span class="number">156</span>, <span class="number">21</span>, <span class="number">198</span>, <span class="number">65</span>, <span class="number">218</span>, <span class="number">13</span>, <span class="number">216</span>, <span class="number">148</span>, <span class="number">105</span>, <span class="number">165</span>, <span class="number">96</span>, <span class="number">250</span>, <span class="number">121</span>, <span class="number">168</span>, <span class="number">23</span>, <span class="number">94</span>, <span class="number">49</span>, <span class="number">79</span>, <span class="number">120</span>, <span class="number">101</span>, <span class="number">211</span>, <span class="number">167</span>, <span class="number">240</span>, <span class="number">75</span>, <span class="number">136</span>, <span class="number">43</span>, <span class="number">70</span>, <span class="number">115</span>, <span class="number">203</span>, <span class="number">220</span>, <span class="number">34</span>, <span class="number">160</span>, <span class="number">188</span>, <span class="number">222</span>, <span class="number">61</span>, <span class="number">169</span>, <span class="number">117</span>, <span class="number">95</span>, <span class="number">134</span>, <span class="number">174</span>, <span class="number">167</span>]</span><br><span class="line">        tmpl = []</span><br><span class="line">        self.tips = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">            tmpl.append(L[i%<span class="built_in">len</span>(L)] ^ s[i])</span><br><span class="line">        rslt = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(tmpl), <span class="number">8</span>):</span><br><span class="line">            longs = tmpl[i:i+<span class="number">8</span>]</span><br><span class="line">            randl = []</span><br><span class="line">            <span class="comment"># IDEA的轮密钥</span></span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">52</span>):</span><br><span class="line">                randl.append(random.getrandbits(<span class="number">16</span>))</span><br><span class="line">            ll = []</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(longs), <span class="number">2</span>):</span><br><span class="line">                ll.append(<span class="built_in">int</span>.from_bytes(longs[j:j+<span class="number">2</span>]))</span><br><span class="line">            <span class="keyword">assert</span> <span class="built_in">len</span>(ll) == <span class="number">4</span></span><br><span class="line">            v1227, v1229, v1230, v1222 = ll</span><br><span class="line">            <span class="keyword">for</span> v1232 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">                v1225 = random.randint(<span class="number">0x9e3779b9</span>, <span class="number">0xc6ef3720</span>)</span><br><span class="line">                <span class="comment"># TEA 密钥</span></span><br><span class="line">                rilv1224 = []</span><br><span class="line">                <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">                    rilv1224.append(random.randint(<span class="number">0x56AA3350</span>, <span class="number">0xa3b1bac6</span>))</span><br><span class="line">                <span class="comment"># XTEA 密钥</span></span><br><span class="line">                rilv1228 = []</span><br><span class="line">                <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">                    rilv1228.append(random.randint(<span class="number">0x677D9197</span>, <span class="number">0xb27022dc</span>))</span><br><span class="line">                <span class="comment"># 半轮魔改IDEA</span></span><br><span class="line">                lv1233 = []</span><br><span class="line">                lv1233.append(self._p1(v1227, randl[<span class="number">6</span> * v1232 + <span class="number">0</span>]) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line">                lv1233.append((v1229 + randl[<span class="number">6</span> * v1232 + <span class="number">1</span>]) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line">                lv1233.append((v1230 + randl[<span class="number">6</span> * v1232 + <span class="number">2</span>]) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line">                lv1233.append(self._p1(v1222, randl[<span class="number">6</span> * v1232 + <span class="number">3</span>]) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line">                lv395 = []</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                    lv395.append(lv1233[j].to_bytes(<span class="number">2</span>, <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">                tmps = <span class="string">b&#x27;&#x27;</span>.join(lv395)</span><br><span class="line">                lv424 = []</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(tmps), <span class="number">4</span>):</span><br><span class="line">                    lv424.append(<span class="built_in">int</span>.from_bytes(tmps[j:j+<span class="number">4</span>], <span class="string">&#x27;little&#x27;</span>))</span><br><span class="line">                <span class="keyword">assert</span> <span class="built_in">len</span>(lv424) == <span class="number">2</span></span><br><span class="line">                <span class="comment"># 魔改TEA</span></span><br><span class="line">                l, r = lv424 <span class="comment"># v1213, v1215</span></span><br><span class="line">                l += ((r &lt;&lt; <span class="number">4</span>) + self._p2(rilv1224[<span class="number">0</span>])) ^ (r + v1225) ^ ((r &gt;&gt; <span class="number">5</span>) + self._p2(rilv1224[<span class="number">1</span>]))</span><br><span class="line">                l &amp;= <span class="number">4294967295</span></span><br><span class="line">                r += ((l &lt;&lt; <span class="number">5</span>) + self._p2(rilv1224[<span class="number">2</span>])) ^ (l + v1225) ^ ((l &gt;&gt; <span class="number">4</span>) + self._p2(rilv1224[<span class="number">3</span>]))</span><br><span class="line">                r &amp;= <span class="number">4294967295</span></span><br><span class="line">                <span class="comment"># 魔改XTEA</span></span><br><span class="line">                l += (((r &lt;&lt; <span class="number">5</span>) ^ (r &gt;&gt; <span class="number">4</span>)) + r) ^ (v1225 + self._p2(rilv1228[<span class="number">4</span> + (v1225 &amp; <span class="number">3</span>)]))</span><br><span class="line">                l &amp;= <span class="number">4294967295</span></span><br><span class="line">                r += (((l &lt;&lt; <span class="number">4</span>) ^ (l &gt;&gt; <span class="number">5</span>)) + l) ^ (v1225 + self._p2(rilv1228[<span class="number">4</span> + ((v1225 &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>)]))</span><br><span class="line">                r &amp;= <span class="number">4294967295</span></span><br><span class="line">                <span class="comment"># 奇数轮更改v1225（TEA/XTEA中的sum）</span></span><br><span class="line">                <span class="keyword">if</span> v1232 &amp; <span class="number">1</span> == <span class="number">1</span>:</span><br><span class="line">                    v1225 = random.getrandbits(<span class="number">32</span>)</span><br><span class="line">                <span class="comment"># 魔改TEA</span></span><br><span class="line">                l += (((r &lt;&lt; <span class="number">3</span>) ^ (r &gt;&gt; <span class="number">6</span>)) + r) ^ (v1225 + self._p2(rilv1228[v1225 &amp; <span class="number">3</span>]))</span><br><span class="line">                l &amp;= <span class="number">4294967295</span></span><br><span class="line">                r += (((l &lt;&lt; <span class="number">4</span>) ^ (l &gt;&gt; <span class="number">5</span>)) + l) ^ (v1225 + self._p2(rilv1228[(v1225 &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]))</span><br><span class="line">                r &amp;= <span class="number">4294967295</span></span><br><span class="line">                <span class="comment"># 魔改XTEA</span></span><br><span class="line">                l += ((r &lt;&lt; <span class="number">4</span>) + self._p2(rilv1224[<span class="number">4</span>])) ^ (r + v1225) ^ ((r &gt;&gt; <span class="number">5</span>) + self._p2(rilv1224[<span class="number">5</span>]))</span><br><span class="line">                l &amp;= <span class="number">4294967295</span></span><br><span class="line">                r += ((l &lt;&lt; <span class="number">2</span>) + self._p2(rilv1224[<span class="number">6</span>])) ^ (l + v1225) ^ ((l &gt;&gt; <span class="number">7</span>) + self._p2(rilv1224[<span class="number">7</span>]))</span><br><span class="line">                r &amp;= <span class="number">4294967295</span></span><br><span class="line">                tmps = <span class="string">b&#x27;&#x27;</span>.join([x.to_bytes(<span class="number">4</span>, <span class="string">&#x27;little&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> [l, r]])</span><br><span class="line">                lv770 = []</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(tmps), <span class="number">2</span>):</span><br><span class="line">                    lv770.append(<span class="built_in">int</span>.from_bytes(tmps[j:j+<span class="number">2</span>], <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">                <span class="keyword">assert</span> <span class="built_in">len</span>(lv770) == <span class="number">4</span></span><br><span class="line">                <span class="comment"># 另外半轮魔改IDEA</span></span><br><span class="line">                a, b, c, d = lv770 <span class="comment"># v1242, v1241, v1240, v1239</span></span><br><span class="line">                v1196 = self._p1((a ^ c) &amp; <span class="number">0xFFFF</span>, randl[v1232 * <span class="number">6</span> + <span class="number">4</span>])</span><br><span class="line">                v835 = self._p1(((b ^ d) + v1196) &amp; <span class="number">0xFFFF</span>, randl[v1232 * <span class="number">6</span> + <span class="number">5</span>]) &amp; <span class="number">0xFFFF</span></span><br><span class="line">                v1198 = (v1196 + v835) &amp; <span class="number">0xFFFF</span></span><br><span class="line">                v840 = a ^ v835</span><br><span class="line">                v841 = d ^ v1198</span><br><span class="line">                v842 = b ^ v1198</span><br><span class="line">                v91 = c ^ v835</span><br><span class="line">                <span class="comment"># 奇数轮和偶数轮交接给下一轮的变量不同</span></span><br><span class="line">                <span class="keyword">if</span> v1232 &amp; <span class="number">1</span> != <span class="number">0</span>:</span><br><span class="line">                    v1230 = v91</span><br><span class="line">                    v1229 = v842</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    v1230 = v842</span><br><span class="line">                    v1229 = v91</span><br><span class="line">                v1222 = v841</span><br><span class="line">                v1227 = v840</span><br><span class="line">            <span class="comment"># 最后半轮魔改IDEA</span></span><br><span class="line">            v1227 = self._p1(v1227 &amp; <span class="number">0xFFFF</span>, randl[<span class="number">48</span>]) &amp; <span class="number">0xFFFF</span></span><br><span class="line">            v1229 = (v1229 + randl[<span class="number">49</span>]) &amp; <span class="number">0xFFFF</span></span><br><span class="line">            v1230 = (v1230 + randl[<span class="number">50</span>]) &amp; <span class="number">0xFFFF</span></span><br><span class="line">            v1222 = self._p1(v1222 &amp; <span class="number">0xFFFF</span>, randl[<span class="number">51</span>]) &amp; <span class="number">0xFFFF</span></span><br><span class="line">            ll = [v1227, v1229, v1230, v1222]</span><br><span class="line">            lv918 = []</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ll)):</span><br><span class="line">                lv918.append(ll[j].to_bytes(<span class="number">2</span>, <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">            tmps = <span class="string">b&#x27;&#x27;</span>.join(lv918)</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">list</span>(tmps))</span><br><span class="line">            rslt += tmps</span><br><span class="line">            <span class="comment"># 真正的比对在这里（</span></span><br><span class="line">            self.tips += <span class="built_in">sum</span>([tmps[j] ^ random.getrandbits(<span class="number">8</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tmps))])</span><br><span class="line">        <span class="built_in">print</span>(self.tips, <span class="built_in">list</span>(rslt))</span><br><span class="line">        <span class="comment"># 没用的返回值，真随机</span></span><br><span class="line">        <span class="keyword">return</span> [x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(os.urandom(<span class="built_in">len</span>(rslt)), rslt)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    c = chal(<span class="string">&quot;a&quot;</span>*<span class="number">48</span>) <span class="comment"># 测试</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>其中关键点在于，其对比不是用<code>self._var2</code>和<code>self._var3</code>进行对比，而是用当前轮的<code>random.getrandbits(8)</code>进行对比，xor为0表示相同，只要最后<code>self._tips == 0</code>就算成功。所以，<strong>比对数据实际上是一组伪随机数</strong>！</p>
</blockquote>
<p>最后写解密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># 假密文！！！</span></span><br><span class="line">dst = [<span class="number">121</span>, <span class="number">73</span>, <span class="number">141</span>, <span class="number">146</span>, <span class="number">115</span>, <span class="number">230</span>, <span class="number">181</span>, <span class="number">65</span>, <span class="number">238</span>, <span class="number">17</span>, <span class="number">146</span>, <span class="number">73</span>, <span class="number">228</span>, <span class="number">82</span>, <span class="number">188</span>, <span class="number">66</span>, <span class="number">12</span>, <span class="number">148</span>, <span class="number">225</span>, <span class="number">66</span>, <span class="number">255</span>, <span class="number">254</span>, <span class="number">47</span>, <span class="number">22</span>, <span class="number">163</span>, <span class="number">250</span>, <span class="number">222</span>, <span class="number">133</span>, <span class="number">35</span>, <span class="number">232</span>, <span class="number">106</span>, <span class="number">176</span>]</span><br><span class="line">dst += [<span class="number">12</span>, <span class="number">243</span>, <span class="number">133</span>, <span class="number">147</span>, <span class="number">7</span>, <span class="number">36</span>, <span class="number">29</span>, <span class="number">49</span>, <span class="number">226</span>, <span class="number">211</span>, <span class="number">156</span>, <span class="number">56</span>, <span class="number">142</span>, <span class="number">78</span>, <span class="number">254</span>, <span class="number">12</span>]</span><br><span class="line">random.seed(<span class="built_in">sum</span>([<span class="number">2654435769</span>-<span class="built_in">len</span>(dst)] + [<span class="built_in">ord</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">str</span>(<span class="built_in">len</span>(dst))]))</span><br><span class="line"></span><br><span class="line">r_randl = []</span><br><span class="line">r8_v1225 = []</span><br><span class="line">r8_rilv1224 = []</span><br><span class="line">r8_rilv1228 = []</span><br><span class="line">r8_rand8b = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(dst), <span class="number">8</span>):</span><br><span class="line">    r_randl.append([random.getrandbits(<span class="number">16</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">52</span>)])</span><br><span class="line">    tmpl = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        tmpl.append(random.randint(<span class="number">0x9e3779b9</span>, <span class="number">0xc6ef3720</span>))</span><br><span class="line">        r8_rilv1224.append([random.randint(<span class="number">0x56AA3350</span>, <span class="number">0xa3b1bac6</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)])</span><br><span class="line">        r8_rilv1228.append([random.randint(<span class="number">0x677D9197</span>, <span class="number">0xb27022dc</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)])</span><br><span class="line">        <span class="keyword">if</span> i &amp; <span class="number">1</span> == <span class="number">1</span>:</span><br><span class="line">            tmpl.append(random.getrandbits(<span class="number">32</span>))</span><br><span class="line">    r8_v1225 += tmpl[::-<span class="number">1</span>]</span><br><span class="line">    r8_rand8b.append([random.getrandbits(<span class="number">8</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)])</span><br><span class="line">v1225_iter = <span class="built_in">iter</span>(r8_v1225)</span><br><span class="line"><span class="comment"># 真密文</span></span><br><span class="line">dst = <span class="built_in">sum</span>(r8_rand8b, [])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_p1</span>(<span class="params">a, b</span>):</span><br><span class="line">    c = a * b</span><br><span class="line">    cl = c &amp; <span class="number">0xFFFF</span></span><br><span class="line">    ch = (c &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFFFF</span></span><br><span class="line">    <span class="keyword">if</span> cl - ch &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> cl - ch + <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> cl - ch</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_p2</span>(<span class="params">i</span>):</span><br><span class="line">    l = [<span class="number">214</span>, <span class="number">144</span>, <span class="number">233</span>, <span class="number">254</span>, <span class="number">204</span>, <span class="number">225</span>, <span class="number">61</span>, <span class="number">183</span>, <span class="number">22</span>, <span class="number">182</span>, <span class="number">20</span>, <span class="number">194</span>, <span class="number">40</span>, <span class="number">251</span>, <span class="number">44</span>, <span class="number">5</span>, <span class="number">43</span>, <span class="number">103</span>, <span class="number">154</span>, <span class="number">118</span>, <span class="number">42</span>, <span class="number">190</span>, <span class="number">4</span>, <span class="number">195</span>, <span class="number">170</span>, <span class="number">68</span>, <span class="number">19</span>, <span class="number">38</span>, <span class="number">73</span>, <span class="number">134</span>, <span class="number">6</span>, <span class="number">153</span>, <span class="number">156</span>, <span class="number">66</span>, <span class="number">80</span>, <span class="number">244</span>, <span class="number">145</span>, <span class="number">239</span>, <span class="number">152</span>, <span class="number">122</span>, <span class="number">51</span>, <span class="number">84</span>, <span class="number">11</span>, <span class="number">67</span>, <span class="number">237</span>, <span class="number">207</span>, <span class="number">172</span>, <span class="number">98</span>, <span class="number">228</span>, <span class="number">179</span>, <span class="number">28</span>, <span class="number">169</span>, <span class="number">201</span>, <span class="number">8</span>, <span class="number">232</span>, <span class="number">149</span>, <span class="number">128</span>, <span class="number">223</span>, <span class="number">148</span>, <span class="number">250</span>, <span class="number">117</span>, <span class="number">143</span>, <span class="number">63</span>, <span class="number">166</span>, <span class="number">71</span>, <span class="number">7</span>, <span class="number">167</span>, <span class="number">252</span>, <span class="number">243</span>, <span class="number">115</span>, <span class="number">23</span>, <span class="number">186</span>, <span class="number">131</span>, <span class="number">89</span>, <span class="number">60</span>, <span class="number">25</span>, <span class="number">230</span>, <span class="number">133</span>, <span class="number">79</span>, <span class="number">168</span>, <span class="number">104</span>, <span class="number">107</span>, <span class="number">129</span>, <span class="number">178</span>, <span class="number">113</span>, <span class="number">100</span>, <span class="number">218</span>, <span class="number">139</span>, <span class="number">248</span>, <span class="number">235</span>, <span class="number">15</span>, <span class="number">75</span>, <span class="number">112</span>, <span class="number">86</span>, <span class="number">157</span>, <span class="number">53</span>, <span class="number">30</span>, <span class="number">36</span>, <span class="number">14</span>, <span class="number">94</span>, <span class="number">99</span>, <span class="number">88</span>, <span class="number">209</span>, <span class="number">162</span>, <span class="number">37</span>, <span class="number">34</span>, <span class="number">124</span>, <span class="number">59</span>, <span class="number">1</span>, <span class="number">33</span>, <span class="number">120</span>, <span class="number">135</span>, <span class="number">212</span>, <span class="number">0</span>, <span class="number">70</span>, <span class="number">87</span>, <span class="number">159</span>, <span class="number">211</span>, <span class="number">39</span>, <span class="number">82</span>, <span class="number">76</span>, <span class="number">54</span>, <span class="number">2</span>, <span class="number">231</span>, <span class="number">160</span>, <span class="number">196</span>, <span class="number">200</span>, <span class="number">158</span>, <span class="number">234</span>, <span class="number">191</span>, <span class="number">138</span>, <span class="number">210</span>, <span class="number">64</span>, <span class="number">199</span>, <span class="number">56</span>, <span class="number">181</span>, <span class="number">163</span>, <span class="number">247</span>, <span class="number">242</span>, <span class="number">206</span>, <span class="number">249</span>, <span class="number">97</span>, <span class="number">21</span>, <span class="number">161</span>, <span class="number">224</span>, <span class="number">174</span>, <span class="number">93</span>, <span class="number">164</span>, <span class="number">155</span>, <span class="number">52</span>, <span class="number">26</span>, <span class="number">85</span>, <span class="number">173</span>, <span class="number">147</span>, <span class="number">50</span>, <span class="number">48</span>, <span class="number">245</span>, <span class="number">140</span>, <span class="number">177</span>, <span class="number">227</span>, <span class="number">29</span>, <span class="number">246</span>, <span class="number">226</span>, <span class="number">46</span>, <span class="number">130</span>, <span class="number">102</span>, <span class="number">202</span>, <span class="number">96</span>, <span class="number">192</span>, <span class="number">41</span>, <span class="number">35</span>, <span class="number">171</span>, <span class="number">13</span>, <span class="number">83</span>, <span class="number">78</span>, <span class="number">111</span>, <span class="number">213</span>, <span class="number">219</span>, <span class="number">55</span>, <span class="number">69</span>, <span class="number">222</span>, <span class="number">253</span>, <span class="number">142</span>, <span class="number">47</span>, <span class="number">3</span>, <span class="number">255</span>, <span class="number">106</span>, <span class="number">114</span>, <span class="number">109</span>, <span class="number">108</span>, <span class="number">91</span>, <span class="number">81</span>, <span class="number">141</span>, <span class="number">27</span>, <span class="number">175</span>, <span class="number">146</span>, <span class="number">187</span>, <span class="number">221</span>, <span class="number">188</span>, <span class="number">127</span>, <span class="number">17</span>, <span class="number">217</span>, <span class="number">92</span>, <span class="number">65</span>, <span class="number">31</span>, <span class="number">16</span>, <span class="number">90</span>, <span class="number">216</span>, <span class="number">10</span>, <span class="number">193</span>, <span class="number">49</span>, <span class="number">136</span>, <span class="number">165</span>, <span class="number">205</span>, <span class="number">123</span>, <span class="number">189</span>, <span class="number">45</span>, <span class="number">116</span>, <span class="number">208</span>, <span class="number">18</span>, <span class="number">184</span>, <span class="number">229</span>, <span class="number">180</span>, <span class="number">176</span>, <span class="number">137</span>, <span class="number">105</span>, <span class="number">151</span>, <span class="number">74</span>, <span class="number">12</span>, <span class="number">150</span>, <span class="number">119</span>, <span class="number">126</span>, <span class="number">101</span>, <span class="number">185</span>, <span class="number">241</span>, <span class="number">9</span>, <span class="number">197</span>, <span class="number">110</span>, <span class="number">198</span>, <span class="number">132</span>, <span class="number">24</span>, <span class="number">240</span>, <span class="number">125</span>, <span class="number">236</span>, <span class="number">58</span>, <span class="number">220</span>, <span class="number">77</span>, <span class="number">32</span>, <span class="number">121</span>, <span class="number">238</span>, <span class="number">95</span>, <span class="number">62</span>, <span class="number">215</span>, <span class="number">203</span>, <span class="number">57</span>, <span class="number">72</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>.from_bytes(<span class="built_in">bytes</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: l[x], i.to_bytes(<span class="number">4</span>, <span class="string">&#x27;little&#x27;</span>))), <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">p1_rev</span>(<span class="params">ret, b</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x10000</span>):</span><br><span class="line">        <span class="keyword">if</span> ret == (_p1(i, b) &amp; <span class="number">0xFFFF</span>):</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line">res = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> xi <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(dst), <span class="number">8</span>):</span><br><span class="line">    randl = r_randl[xi//<span class="number">8</span>]</span><br><span class="line">    l8 = dst[xi:xi+<span class="number">8</span>]</span><br><span class="line">    l4 = [<span class="built_in">int</span>.from_bytes(<span class="built_in">bytes</span>(l8[i:i+<span class="number">2</span>]), <span class="string">&#x27;big&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(l8), <span class="number">2</span>)]</span><br><span class="line">    v1227, v1229, v1230, v1222 = l4</span><br><span class="line">    v1227 = p1_rev(v1227, randl[<span class="number">48</span>]) &amp; <span class="number">0xFFFF</span></span><br><span class="line">    v1229 = (v1229 - randl[<span class="number">49</span>]) &amp; <span class="number">0xFFFF</span></span><br><span class="line">    v1230 = (v1230 - randl[<span class="number">50</span>]) &amp; <span class="number">0xFFFF</span></span><br><span class="line">    v1222 = p1_rev(v1222, randl[<span class="number">51</span>]) &amp; <span class="number">0xFFFF</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)[::-<span class="number">1</span>]:</span><br><span class="line">        rilv1224 = r8_rilv1224[xi + i]</span><br><span class="line">        rilv1228 = r8_rilv1228[xi + i]</span><br><span class="line">        v841 = v1222</span><br><span class="line">        v840 = v1227</span><br><span class="line">        <span class="keyword">if</span> i &amp; <span class="number">1</span> != <span class="number">0</span>:</span><br><span class="line">            v91 = v1230</span><br><span class="line">            v842 = v1229</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            v842 = v1230</span><br><span class="line">            v91 = v1229</span><br><span class="line">        a_xor_c = v840 ^ v91</span><br><span class="line">        b_xor_d = v841 ^ v842</span><br><span class="line">        v1196 = _p1(a_xor_c, randl[i * <span class="number">6</span> + <span class="number">4</span>]) &amp; <span class="number">0xFFFF</span></span><br><span class="line">        v835 = _p1((b_xor_d + v1196) &amp; <span class="number">0xFFFF</span>, randl[i * <span class="number">6</span> + <span class="number">5</span>]) &amp; <span class="number">0xFFFF</span></span><br><span class="line">        v1198 = (v1196 + v835) &amp; <span class="number">0xFFFF</span></span><br><span class="line">        a = v840 ^ v835</span><br><span class="line">        b = v842 ^ v1198</span><br><span class="line">        c = v91 ^ v835</span><br><span class="line">        d = v841 ^ v1198</span><br><span class="line">        l4 = [a, b, c, d]</span><br><span class="line">        s = <span class="string">b&#x27;&#x27;</span>.join([x.to_bytes(<span class="number">2</span>, <span class="string">&#x27;big&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> l4])</span><br><span class="line">        l, r = [<span class="built_in">int</span>.from_bytes(s[j:j+<span class="number">4</span>], <span class="string">&#x27;little&#x27;</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(s), <span class="number">4</span>)]</span><br><span class="line">        v1225 = <span class="built_in">next</span>(v1225_iter)</span><br><span class="line">        r -= ((l &lt;&lt; <span class="number">2</span>) + _p2(rilv1224[<span class="number">6</span>])) ^ (l + v1225) ^ ((l &gt;&gt; <span class="number">7</span>) + _p2(rilv1224[<span class="number">7</span>]))</span><br><span class="line">        r &amp;= <span class="number">4294967295</span></span><br><span class="line">        l -= ((r &lt;&lt; <span class="number">4</span>) + _p2(rilv1224[<span class="number">4</span>])) ^ (r + v1225) ^ ((r &gt;&gt; <span class="number">5</span>) + _p2(rilv1224[<span class="number">5</span>]))</span><br><span class="line">        l &amp;= <span class="number">4294967295</span></span><br><span class="line">        r -= (((l &lt;&lt; <span class="number">4</span>) ^ (l &gt;&gt; <span class="number">5</span>)) + l) ^ (v1225 + _p2(rilv1228[(v1225 &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]))</span><br><span class="line">        r &amp;= <span class="number">4294967295</span></span><br><span class="line">        l -= (((r &lt;&lt; <span class="number">3</span>) ^ (r &gt;&gt; <span class="number">6</span>)) + r) ^ (v1225 + _p2(rilv1228[v1225 &amp; <span class="number">3</span>]))</span><br><span class="line">        l &amp;= <span class="number">4294967295</span></span><br><span class="line">        <span class="keyword">if</span> i &amp; <span class="number">1</span> == <span class="number">1</span>:</span><br><span class="line">            v1225 = <span class="built_in">next</span>(v1225_iter)</span><br><span class="line">        r -= (((l &lt;&lt; <span class="number">4</span>) ^ (l &gt;&gt; <span class="number">5</span>)) + l) ^ (v1225 + _p2(rilv1228[<span class="number">4</span> + ((v1225 &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>)]))</span><br><span class="line">        r &amp;= <span class="number">4294967295</span></span><br><span class="line">        l -= (((r &lt;&lt; <span class="number">5</span>) ^ (r &gt;&gt; <span class="number">4</span>)) + r) ^ (v1225 + _p2(rilv1228[<span class="number">4</span> + (v1225 &amp; <span class="number">3</span>)]))</span><br><span class="line">        l &amp;= <span class="number">4294967295</span></span><br><span class="line">        r -= ((l &lt;&lt; <span class="number">5</span>) + _p2(rilv1224[<span class="number">2</span>])) ^ (l + v1225) ^ ((l &gt;&gt; <span class="number">4</span>) + _p2(rilv1224[<span class="number">3</span>]))</span><br><span class="line">        r &amp;= <span class="number">4294967295</span></span><br><span class="line">        l -= ((r &lt;&lt; <span class="number">4</span>) + _p2(rilv1224[<span class="number">0</span>])) ^ (r + v1225) ^ ((r &gt;&gt; <span class="number">5</span>) + _p2(rilv1224[<span class="number">1</span>]))</span><br><span class="line">        l &amp;= <span class="number">4294967295</span></span><br><span class="line">        s = <span class="string">b&#x27;&#x27;</span>.join([x.to_bytes(<span class="number">4</span>, <span class="string">&#x27;little&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> [l, r]])</span><br><span class="line">        v1227, v1229, v1230, v1222 = [<span class="built_in">int</span>.from_bytes(s[j:j+<span class="number">2</span>], <span class="string">&#x27;big&#x27;</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(s), <span class="number">2</span>)]</span><br><span class="line">        v1227 = p1_rev(v1227, randl[<span class="number">6</span> * i + <span class="number">0</span>]) &amp; <span class="number">0xFFFF</span></span><br><span class="line">        v1229 = (v1229 - randl[<span class="number">6</span> * i + <span class="number">1</span>]) &amp; <span class="number">0xFFFF</span></span><br><span class="line">        v1230 = (v1230 - randl[<span class="number">6</span> * i + <span class="number">2</span>]) &amp; <span class="number">0xFFFF</span></span><br><span class="line">        v1222 = p1_rev(v1222, randl[<span class="number">6</span> * i + <span class="number">3</span>]) &amp; <span class="number">0xFFFF</span></span><br><span class="line">    res += <span class="string">b&#x27;&#x27;</span>.join([x.to_bytes(<span class="number">2</span>, <span class="string">&#x27;big&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> [v1227, v1229, v1230, v1222]])</span><br><span class="line"></span><br><span class="line">L = [<span class="number">173</span>, <span class="number">7</span>, <span class="number">131</span>, <span class="number">63</span>, <span class="number">141</span>, <span class="number">180</span>, <span class="number">193</span>, <span class="number">156</span>, <span class="number">21</span>, <span class="number">198</span>, <span class="number">65</span>, <span class="number">218</span>, <span class="number">13</span>, <span class="number">216</span>, <span class="number">148</span>, <span class="number">105</span>, <span class="number">165</span>, <span class="number">96</span>, <span class="number">250</span>, <span class="number">121</span>, <span class="number">168</span>, <span class="number">23</span>, <span class="number">94</span>, <span class="number">49</span>, <span class="number">79</span>, <span class="number">120</span>, <span class="number">101</span>, <span class="number">211</span>, <span class="number">167</span>, <span class="number">240</span>, <span class="number">75</span>, <span class="number">136</span>, <span class="number">43</span>, <span class="number">70</span>, <span class="number">115</span>, <span class="number">203</span>, <span class="number">220</span>, <span class="number">34</span>, <span class="number">160</span>, <span class="number">188</span>, <span class="number">222</span>, <span class="number">61</span>, <span class="number">169</span>, <span class="number">117</span>, <span class="number">95</span>, <span class="number">134</span>, <span class="number">174</span>, <span class="number">167</span>]</span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(res)):</span><br><span class="line">    flag.append(res[i] ^ L[i%<span class="built_in">len</span>(L)])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(flag))</span><br><span class="line"><span class="comment"># b&#x27;DASCTF&#123;c6090fd29eaf2ae1d111289e3f3c0c7a3819dcc1&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">WoaW04</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/09/18/2024%E7%BE%8A%E5%9F%8E%E6%9D%AFchal/">http://example.com/2024/09/18/2024%E7%BE%8A%E5%9F%8E%E6%9D%AFchal/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">The Blog of WoaW04</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/RE/">RE</a><a class="post-meta__tags" href="/tags/2024%E7%BE%8A%E5%9F%8E%E6%9D%AF/">2024羊城杯</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/WoaW04/Picture/main/202409182255885.png" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/10/01/QilingLab-%E4%B8%8A%E6%89%8BQilingFramework/" title="QilingLab-上手QilingFramework"><img class="cover" src="https://raw.githubusercontent.com/WoaW04/Picture/main/202410010015849.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">QilingLab-上手QilingFramework</div></div></a></div><div class="next-post pull-right"><a href="/2024/09/17/2024%E7%BE%8A%E5%9F%8E%E6%9D%AF%E4%BD%A0%E8%BF%99%E4%B8%BB%E5%87%BD%E6%95%B0%E4%BF%9D%E7%9C%9F%E4%B9%88/" title="2024羊城杯你这主函数保真么"><img class="cover" src="https://raw.githubusercontent.com/WoaW04/Picture/main/202409171702467.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">2024羊城杯你这主函数保真么</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/WoaW04/Picture/image04CTF.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">WoaW04</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">53</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/WoaW04"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">0x00 前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-%E8%A7%A3"><span class="toc-number">2.</span> <span class="toc-text">0x01 解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#C%E7%BA%A7%E5%88%AB%E7%9A%84%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E8%B5%8B%E5%80%BC"><span class="toc-number">2.1.</span> <span class="toc-text">C级别的全局变量赋值</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.1.1.</span> <span class="toc-text">字符串类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.1.2.</span> <span class="toc-text">整数类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0-%E5%8F%98%E9%87%8F"><span class="toc-number">2.1.3.</span> <span class="toc-text">内建函数&#x2F;变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E9%87%8F"><span class="toc-number">2.1.4.</span> <span class="toc-text">常量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E%E5%8F%8A%E5%AE%9A%E4%B9%89"><span class="toc-number">2.1.5.</span> <span class="toc-text">函数声明及定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#import"><span class="toc-number">2.1.6.</span> <span class="toc-text">import</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python%E4%BB%A3%E7%A0%81%E7%9A%84%E8%BD%AC%E8%AF%91"><span class="toc-number">2.2.</span> <span class="toc-text">Python代码的转译</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%8F%98%E9%87%8F%E8%B5%8B%E5%80%BC"><span class="toc-number">2.2.1.</span> <span class="toc-text">对象变量赋值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E8%B5%8B%E5%80%BC"><span class="toc-number">2.2.2.</span> <span class="toc-text">数组赋值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90"><span class="toc-number">2.2.3.</span> <span class="toc-text">参数解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="toc-number">2.2.4.</span> <span class="toc-text">函数调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94"><span class="toc-number">2.2.5.</span> <span class="toc-text">对比</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%96%E6%95%B0%E7%BB%84%E9%95%BF%E5%BA%A6"><span class="toc-number">2.2.6.</span> <span class="toc-text">取数组长度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E7%AE%97"><span class="toc-number">2.2.7.</span> <span class="toc-text">运算</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HOOK%E8%BE%85%E5%8A%A9"><span class="toc-number">2.3.</span> <span class="toc-text">HOOK辅助</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98"><span class="toc-number">2.4.</span> <span class="toc-text">解题</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background: #FFFFFF00"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2024 By WoaW04</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div></div></body></html>